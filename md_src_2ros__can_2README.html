<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FSFEUP-Autonomous-Systems: ros_can</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FSFEUP-Autonomous-Systems
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">ros_can</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md57"></a> This is a ROS 2 node used to communicate with the ADS-DV over the CAN bus.</p>
<h2><a class="anchor" id="autotoc_md58"></a>
Dependencies</h2>
<ul>
<li>All ROS dependencies found in the package manifest as usual.</li>
<li><code>eufs_msgs</code> found <a href="https://gitlab.com/eufs/eufs_msgs">here</a></li>
<li>Ability to communicate through CAN</li>
</ul>
<h1><a class="anchor" id="autotoc_md59"></a>
Nodes</h1>
<h2><a class="anchor" id="autotoc_md60"></a>
ros_can</h2>
<p>This is a node that communicates over CAN to the ADS-DV to both receive data from its ECU but also to control it. To achieve this it uses the C library found in the <code>FS-AI-API</code> submodule. This node can convert acceleration and steering (radians) commands into an appropriate car torque/braking and steering (degrees) commands and send them to the car. It is also able to indicate mission completion to the car. The node publishes information it receives from the wheel odometry and steering feedback from the car, information about the internal <a href="http://www.imeche.org/docs/default-source/1-oscar/formula-student/2019/fs-ai/ads-dv-software-interface-specification-v0-2.pdf?sfvrsn=2">state machine of the vehicle</a>, and data from the onboard IMU and GPS.</p>
<h3><a class="anchor" id="autotoc_md61"></a>
Subscribers</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>/cmd</code>   </td><td class="markdownTableBodyNone">ackermann_msgs/AckermannDriveStamped   </td><td class="markdownTableBodyNone">Control commands to send to the car    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>/ros_can/mission_flag</code>   </td><td class="markdownTableBodyNone">std_msgs/Bool   </td><td class="markdownTableBodyNone">Mission flag to control the state machine of the ADS-DV car    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>/state_machine/driving_flag</code>   </td><td class="markdownTableBodyNone">std_msgs/Bool   </td><td class="markdownTableBodyNone">Flag to indicate when <a class="el" href="namespaceros__can.html">ros_can</a> should start accepting /cmd commands   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md62"></a>
Publishers</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>/ros_can/state</code>   </td><td class="markdownTableBodyNone">eufs_msgs/CanState   </td><td class="markdownTableBodyNone">AS and AMI State of the ADS-DV.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>/ros_can/state_str</code>   </td><td class="markdownTableBodyNone">std_msgs/String   </td><td class="markdownTableBodyNone">Same as above but in string format. Used for debugging.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>/ros_can/wheel_speeds</code>   </td><td class="markdownTableBodyNone">eufs_msgs/WheelSpeedsStamped   </td><td class="markdownTableBodyNone">Wheel odometry and steering feedback from the car.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>/ros_can/twist</code>   </td><td class="markdownTableBodyNone">geometry_msgs/TwistWithCovarianceStamped   </td><td class="markdownTableBodyNone">Forward linear and angular velocity based on wheel speeds.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>/ros_can/vehicle_commands</code>   </td><td class="markdownTableBodyNone">eufs_msgs/VehicleCommandsStamped   </td><td class="markdownTableBodyNone">Control information sent to the car. For debugging purposes.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>/ros_can/imu</code>   </td><td class="markdownTableBodyNone">sensor_msgs/Imu   </td><td class="markdownTableBodyNone">Data from the onboard IMU.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>/ros_can/fix</code>   </td><td class="markdownTableBodyNone">sensor_msgs/NavSatFix   </td><td class="markdownTableBodyNone">Data from the onboard GPS.   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md63"></a>
Parameters</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>can_interface</code>   </td><td class="markdownTableBodyNone">string   </td><td class="markdownTableBodyNone">can0   </td><td class="markdownTableBodyNone">Sets the CAN interface in FS-AI library.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>can_debug</code>   </td><td class="markdownTableBodyNone">int   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Starts the FS-AI library in debug mode. Set to something other than 0 to enable    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>simulate_can</code>   </td><td class="markdownTableBodyNone">int   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Starts the FS-AI library with simulated CAN data. Set to something other than 0 to enable    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>loop_rate</code>   </td><td class="markdownTableBodyNone">int   </td><td class="markdownTableBodyNone">100   </td><td class="markdownTableBodyNone">The running frequency of the node    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>rpm_limit</code>   </td><td class="markdownTableBodyNone">float   </td><td class="markdownTableBodyNone">4000.0   </td><td class="markdownTableBodyNone">Sets the max rpm limit that the car can achieve. Use this to set upperbound on velocity    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>max_dec</code>   </td><td class="markdownTableBodyNone">float   </td><td class="markdownTableBodyNone">10.0   </td><td class="markdownTableBodyNone">Assume maximum deceleration of the mechanical brakes.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>engine_threshold</code>   </td><td class="markdownTableBodyNone">float   </td><td class="markdownTableBodyNone">-5.0   </td><td class="markdownTableBodyNone">Maximum deceleration for engine braking. Anything more and we use the mechanical brakes.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>cmd_timeout</code>   </td><td class="markdownTableBodyNone">double   </td><td class="markdownTableBodyNone">0.5   </td><td class="markdownTableBodyNone">Timeout for control commands in seconds. Engage EBS if timeout expires.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>debug_logging</code>   </td><td class="markdownTableBodyNone">bool   </td><td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">Enable debug logging.   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md64"></a>
Notes</h3>
<ul>
<li>This node follows the UK FS-AI rules as per <a href="https://github.com/FS-AI/FS-AI_API/blob/main/Docs/ADS-DV_Software_Interface_Specification_v4.0.pdf">documentation</a>.</li>
<li>CAN communication works over the SocketCAN interface and does not need any additional setup (apart from <code>sudo apt install can_utils</code>)</li>
<li>This node is heavily reliant on the FS-AI CAN interface <a href="https://github.com/FS-AI/FS-AI_API">library</a>. See it for updates and further information.</li>
<li>This node controls the car in "torque mode" using acceleration input commands</li>
<li>To run with the DDT car, ensure you run the start script in the FS-AI-API submodule.</li>
<li>We negate the steering angle received from the car. This is to make positive steering a left turn.</li>
</ul>
<h3><a class="anchor" id="autotoc_md65"></a>
TODO</h3>
<p>See issues tab on Gitlab.</p>
<h1><a class="anchor" id="autotoc_md66"></a>
Launch files</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Filename   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="ros__can_8launch_8py.html">ros_can.launch.py</a></code>   </td><td class="markdownTableBodyNone">Starts the <code><a class="el" href="namespaceros__can.html">ros_can</a></code> node in normal working operation configured for the ADS-DV car   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
