<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Formula Student Autonomous Systems: Planning Module</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Formula Student Autonomous Systems
   </div>
   <div id="projectbrief">The code for the main driverless system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d4/d0c/md_src_2planning_2_r_e_a_d_m_e.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Planning Module</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md176"></a> </p>
<h1><a class="anchor" id="autotoc_md177"></a>
Package Information</h1>
<h2><a class="anchor" id="autotoc_md178"></a>
Description</h2>
<p>The planning module is the third main module in the autonomous system. It comes after the Localization and Mapping processing and precedes the <a class="el" href="../../d7/d49/class_control.html" title="Class responsible for the control of the car.">Control</a> module. It is responsible for processing the cones information(position and color) and to calculate the best path for the car to follow considering the received track. It then sends the desired path to the control in the form of a ordered position sequence.</p>
<h2><a class="anchor" id="autotoc_md179"></a>
Folder Structure</h2>
<ul>
<li><a href="../../include/adapter_planning/">adapter_planning</a>: Adapters to change ros2 interfaces according to simulator or environment</li>
<li><a href="../../include/config/">config</a>: Configuration structures for the planning module</li>
<li><a href="../../include/utils/">utils</a>: Utility functions for the planning module, including spline fitting</li>
<li><a href="../../include/planning/">planning</a>: Main classes and functions for the planning module<ul>
<li><a href="../../include/planning/cone_coloring.hpp">planning/cone_coloring</a>: ConeColoring class, used to attribute a color to unlabeled cones</li>
<li><a href="../../include/planning/path_calculation.hpp">planning/path_calculation</a>: <a class="el" href="../../d0/d89/class_path_calculation.html" title="PathCalculation class for generating local paths.">PathCalculation</a> class, used to calculate the desired path using delaunay triangulation</li>
<li><a href="../../include/planning/path_smoothing.hpp">planning/smoothing</a>: <a class="el" href="../../d7/db7/class_path_smoothing.html" title="class that defines the path smoothing algorithm">PathSmoothing</a> class, used to smooth the path using splines, increasing the number of path points</li>
<li><a href="../../include/planning/outliers.hpp">planning/outliers</a>: <a class="el" href="../../d9/d53/class_outliers.html" title="Class to deal with outliers.">Outliers</a> class, used to remove outliers from the track map</li>
<li><a href="../../include/planning/planning.hpp">planning/planning</a>: Node class</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md180"></a>
Launch Configurations</h2>
<ul>
<li><a href="../../launch/eufs.launch.py">eufs.launch.py</a>: Launches the planning node with the necessary parameters for the EUFS simulator.</li>
<li><a href="../../launch/vehicle.launch.py">vehicle.launch.py</a>: Launches the planning node with the necessary parameters for the 01 vehicle.</li>
<li><a href="../../launch/pacsim.launch.py">pacsim.launch.py</a>: Launches the planning node with the necessary parameters for the PacSim simulator.</li>
</ul>
<h2><a class="anchor" id="autotoc_md181"></a>
Important Dependencies</h2>
<ul>
<li><a href="https://www.cgal.org/">CGAL</a>: Computational Geometry Algorithms Library. Used for Delaunay Triangulations.</li>
<li><a href="https://www.gnu.org/software/gsl/">GSL</a>: GNU Scientific Library. Used for splines.</li>
</ul>
<h1><a class="anchor" id="autotoc_md182"></a>
How to Run</h1>
<h2><a class="anchor" id="autotoc_md183"></a>
Install Dependencies</h2>
<p>You will need CGAL library for the Delaunay Triangulations. GSL library for the splines.</p>
<div class="fragment"><div class="line">./dependencies_install.sh</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md184"></a>
Compiling</h2>
<div class="fragment"><div class="line">colcon build --packages-up-to planning</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md185"></a>
Testing</h2>
<div class="fragment"><div class="line">colcon test --packages-select planning # use event-handler=console_direct+ for imediate output</div>
</div><!-- fragment --><p>To check test results: </p><div class="fragment"><div class="line">colcon test-result --all --verbose</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md186"></a>
Running</h2>
<p>Choose one of the launch files available at the "launch" directory. Each file's name indicates the context in which it should be used. If the name of the file is &lt;file_name&gt; run the following command (replace &lt;file_name&gt; with the actual name of the launch file): </p><div class="fragment"><div class="line">source ./install/setup.bash # If in a new terminal</div>
<div class="line">  ros2 run planning &lt;file_name&gt;</div>
</div><!-- fragment --><p> At each launch file, you can find the arguments which will be passed to the planning node. Those arguments control whether the node publishes visualization messages (which can be used to foxglove), where the node gets its input from, and parameters intrinsic to the algorithms (which were tuned to some extent). At the declaration of each launch argument, you will find the description of the argument and the value which will be used if you launch the node with that launch file. If you want to change the value which will be used, edit the launch file and compile the package again.</p>
<h1><a class="anchor" id="autotoc_md187"></a>
Design</h1>
<p>The architecture of the module may be described according to the following diagrams.</p>
<h2><a class="anchor" id="autotoc_md188"></a>
Class Diagram</h2>
<p>This diagram will focus on the main classes and instances inside the planning module, mentioning only the core units and most important functions.</p>
<p><img src="../../../../docs/diagrams/planning/ClassPlanning.drawio.png" alt="" class="inline"/> </p>
<ul>
<li><b>ROS Node:</b> Serves as the fundamental structure and operational backbone of the system.</li>
<li><b><a class="el" href="../../d9/db5/class_planning.html" title="Class responsible for planning and path generation for our car.">Planning</a>:</b> It is the main orchestrator behind all the processes. It is responsible for the communication with other nodes. It contains an <a class="el" href="../../d3/d7f/class_adapter.html" title="Class that handles the communication between the SpeedEstimation node and the other nodes in the syst...">Adapter</a> instance to manage information from the car/simulator and the main intervenients in the pipeline, as the LocalPathPlanner, responsible for the path calculation, the ConeColoring, responsible for attributing a color to unlabeled cones, the <a class="el" href="../../d7/db7/class_path_smoothing.html" title="class that defines the path smoothing algorithm">PathSmoothing</a>, responsible for smoothing the point array to be published and the <a class="el" href="../../db/df3/struct_track.html">Track</a>, which assembles the cones information after coloring and averages them using splines.</li>
<li><b>LocalPathPlanner:</b> This component is responsible for calculation the desired path. It takes the information from the track and using that it creates a sequence of points within the track boundaries for the control module to use as a reference later on.</li>
<li><b><a class="el" href="../../db/df3/struct_track.html">Track</a>:</b> This component assembles the information received by the track map, splitting and organizing the different cones in side and colors. It can also deals with any outliers by averaging out all cones using splines, and thus transforming the outliers into the main distribution sequence.</li>
<li><b>ConeColoring:</b> This component responsible for attributing a color to unlabeled ones. It starts from a certain pair, and searches for the next cone for each using a cost function, achieving a fully colored track map in the end.</li>
<li><b><a class="el" href="../../d7/db7/class_path_smoothing.html" title="class that defines the path smoothing algorithm">PathSmoothing</a>:</b> This component is responsible for fitting a spline through all the calculated points, smoothing the path the vehicle will follow and augmenting the number of references if necessary.</li>
<li><b>PlanningAdapter:</b> Implementation of the <a class="el" href="../../d3/d7f/class_adapter.html" title="Class that handles the communication between the SpeedEstimation node and the other nodes in the syst...">Adapter</a> Pattern. It is an abstraction layer that's used to receive and interact with the car or simulator, depending on the current usage. It can be used for example to control the current event or the car state.</li>
</ul>
<h2><a class="anchor" id="autotoc_md189"></a>
Sequence Diagram</h2>
<p>The planning module receives the track map(a cone array) from the Localization and Mapping block. The main module receives it and will send it to the Cone Coloring to attribute a side to each. The <a class="el" href="../../db/df3/struct_track.html">Track</a> instance is then filled with these and deals with outliers by averaging the margins using splines. The next step is transmitting the track to the Local Path Planner, which will calculate the ideal path and return it. Finally, these points are sent to the <a class="el" href="../../d7/db7/class_path_smoothing.html" title="class that defines the path smoothing algorithm">PathSmoothing</a>, where they are processed by a spline approximation, being then returned back to the main module. The path is then forwarded to the subsequent node <a class="el" href="../../d7/d49/class_control.html" title="Class responsible for the control of the car.">Control</a>.</p>
<p><img src="../../../../docs/diagrams/planning/SequencePlanning.drawio.png" alt="" class="inline"/> </p>
<h2><a class="anchor" id="autotoc_md190"></a>
Activity Diagram</h2>
<p>The planning module doesn't have many different flows. The main one to notice is the difference in the action depending on the event. Since for the Skidpad and Acceleration Events, the best path is already calculated, the module will just go find that data and send it. If we are not in the presence of those, the flow will follow just like previously mentioned.</p>
<p><img src="../../../../docs/diagrams/planning/ActivityPlanning.drawio.png" alt="" style="width: 50%; height: auto;" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
