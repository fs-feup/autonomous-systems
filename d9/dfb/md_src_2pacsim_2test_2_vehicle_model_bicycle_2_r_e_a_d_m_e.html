<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Formula Student Autonomous Systems: Unit testing for the bicycleModel currently used for the Pacsim simulator</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Formula Student Autonomous Systems
   </div>
   <div id="projectbrief">The code for the main driverless system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d9/dfb/md_src_2pacsim_2test_2_vehicle_model_bicycle_2_r_e_a_d_m_e.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Unit testing for the bicycleModel currently used for the Pacsim simulator</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md138"></a> </p>
<h1><a class="anchor" id="autotoc_md139"></a>
Objective:</h1>
<p>Validate the pacsim simulator by unit testing all relevant functions used in the simulator.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md140"></a>
Tested functions and methods used:</h1>
<ol type="1">
<li><a href="../../../../src/VehicleModel/VehicleModelBicycle.cpp#L114">CalculateForces</a>: <em>See line 114</em><ul>
<li>Dependencies: None.</li>
<li>Cases tested:<ul>
<li>Zero: Velocity in the X axis is zero.<ul>
<li>Expected:<ul>
<li>Downforce: 0</li>
<li>Drag: 0</li>
</ul>
</li>
</ul>
</li>
<li>Positive: Velocity in the X axis is greater than zero.<ul>
<li>Expected for velocity = 5 m/s:<ul>
<li>Downforce: 6.1017</li>
<li>Drag: -5.17935</li>
</ul>
</li>
</ul>
</li>
<li>Negative: Velocity in the X axis is smaller than zero.<ul>
<li>Expected for velocity = -5 m/s:<ul>
<li>Downforce: 6.1017</li>
<li>Drag: 5.17935</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Graph: <img src="../../plotCalcForces.png" alt="Downforce and drag based on velocityX" class="inline"/></li>
</ul>
</li>
<li><a href="../../(../../src/VehicleModel/VehicleModelBicycle.cpp#L182)">CalculateEfficiency</a>: <em>See Line 182</em><ul>
<li>Dependencies: None.</li>
<li>Cases tested:<ul>
<li>Low torque: Back wheels torque is set to a low value(5).<ul>
<li>Expected: 0.617.</li>
</ul>
</li>
<li>Medium torque: Back wheels torque is set to half of the maximum value (30).<ul>
<li>Expected: 0.732.</li>
</ul>
</li>
<li>High torque: Back wheels torque is to maximum torque(60).<ul>
<li>Expected: 0.879.</li>
</ul>
</li>
<li>Negative torque: Back wheels troque is set to a small negative value (-5) to simulate braking.<ul>
<li>Expected: 0.617.</li>
</ul>
</li>
</ul>
</li>
<li>Graph: <img src="../../plotCalcEfficiency.png" alt="Efficency based on single wheel torque" class="inline"/></li>
</ul>
</li>
<li><a href="../../../../src/VehicleModel/VehicleModelBicycle.cpp#L312">CalculateLongitudinalForces</a>: <em>See line 312</em><ul>
<li>Dependencies: calculateEfficency (tested before). <blockquote class="doxtable">
<p>&zwj;Since the car is rear-wheel driven all the tests will expect the front wheels to have Fx set to zero, since the car is symmetrical the forces applied in the left wheel needs to be same force applied on the right one too. Although this is not technically unit testing, the dependency for the calculateEfficency has not been mocked since it was also validated.</p>
</blockquote>
</li>
<li>Cases tested:<ul>
<li>Low torque: Back wheels torque is set to a low value(10).<ul>
<li>Expected: 127.10.</li>
</ul>
</li>
<li>Medium torque: Back wheels torque is set to a medium value (30).<ul>
<li>Expected: 433.71.</li>
</ul>
</li>
<li>High torque: Back wheels torque is set to the maximum toerque value (60).<ul>
<li>Expected: 1033.25.</li>
</ul>
</li>
<li>Negative torque: Back wheels torque is set to negative to simulate braking (-10).<ul>
<li>Expected: -127.10</li>
</ul>
</li>
</ul>
</li>
<li>Graph: <img src="../../plotCalcLongitudinal.png" alt="LongitudinalForce from a single back-wheel based on torque" class="inline"/> </li>
</ul>
</li>
</ol>
<ol type="1">
<li><a href="../../../../src/VehicleModel/VehicleModelBicycle.cpp#L234">calculateNormalForces</a>: <em>See line 234</em><ul>
<li>Dependencies: calculateForces (tested previously).</li>
<li>Cases tested:<ul>
<li>Static: Vehicle at rest, flat ground.<ul>
<li>Expected:<ul>
<li>Fz_Front: 516.98.</li>
<li>Fz_Rear: 466.36.</li>
</ul>
</li>
</ul>
</li>
<li>Moving forward: Vehicle moving at 5 m/s.<ul>
<li>Expected:<ul>
<li>Fz_Front: 519.1.</li>
<li>Fz_Rear: 469.3.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Graph: <img src="../../plotCalcNormal.png" alt="Fz_Front and Fz_Rear based on velocity" class="inline"/></li>
</ul>
</li>
<li><a href="../../../../src/VehicleModel/VehicleModelBicycle.cpp#L251">calculateSlipAngles</a>: <em>See line 251</em><ul>
<li>Dependencies: None.</li>
<li>Cases tested:<ul>
<li>Zero velocity: All wheel velocities and angular velocities are zero.<ul>
<li>Expected:<ul>
<li>kappaFront = 0.</li>
<li>kappaRear = 0.</li>
</ul>
</li>
</ul>
</li>
<li>Positive velocity: Vehicle moving forward, no steering (5 m/s).<ul>
<li>Expected:<ul>
<li>kappaFront = 0.</li>
<li>kappaRear = 0.</li>
</ul>
</li>
</ul>
</li>
<li>With steering: Vehicle moving forward (5 m/s), steering set (0.1 rads/s).<ul>
<li>Expected:</li>
<li>kappaFront ≠ 0.</li>
<li>kappaRear ≈ 0.</li>
</ul>
</li>
</ul>
</li>
<li>Graph: <img src="../../plotCalcSlip.png" alt="Slip angles based on yawRate at a fixed speed of 5 m/s" class="inline"/></li>
</ul>
</li>
<li><a href="../../../../src/VehicleModel/VehicleModelBicycle.cpp#L172">calculateWheelTorques</a>: <em>See Line 172</em><ul>
<li>Dependencies: None.</li>
<li>Cases tested:<ul>
<li>Positive throttle input: Throttle is set to maximum (1).<ul>
<li>Expected: 60 torque on each back wheel.</li>
</ul>
</li>
<li>Zero throttle input:<ul>
<li>Expected: 0 torque on all wheels.</li>
</ul>
</li>
<li>Negative throttle input: Throttle is set to minimum (-1).<ul>
<li>Expected: -60 torque on all wheels.</li>
</ul>
</li>
</ul>
</li>
<li>Graph: <img src="../../plotCalcTorq.png" alt="Back-Wheel torque based on throttle input" class="inline"/></li>
</ul>
</li>
<li><a href="../../../../src/VehicleModel/VehicleModelBicycle.cpp#L190">calculateCurrent</a>: <em>See Line 190</em><ul>
<li>Dependencies: None. <blockquote class="doxtable">
<p>&zwj;All this tests assume voltage to be 600 volts.</p>
</blockquote>
</li>
<li>Cases tested:<ul>
<li>Maximum Torque (60) with positive wheel speeds (10):<ul>
<li>Expected: 0.2396.</li>
</ul>
</li>
<li>Negative Torque (-60) with positive wheel speeds (10):<ul>
<li>Expected: -0.2396.</li>
</ul>
</li>
<li>Zero Torque with positive wheel speeds (10):<ul>
<li>Expected: 0.</li>
</ul>
</li>
<li>Maximum torque (60) with zero wheel speeds: -Expected: 0.</li>
</ul>
</li>
<li>Graph: <img src="../../plotCalcCurr.png" alt="Current based on throttle input" class="inline"/> </li>
</ul>
</li>
</ol>
<ol type="1">
<li><a href="../../../../src/VehicleModel/VehicleModelBicycle.cpp#L207">calculateSteeringAngles</a>: <em>See line 207</em><ul>
<li>Dependencies: None. <blockquote class="doxtable">
<p>&zwj;All tests expect the back wheels to have zero steering.</p>
</blockquote>
</li>
<li>Cases tested:<ul>
<li>Positive maximum steering (1):<ul>
<li>Expected:<ul>
<li>Left front wheel: 1.08.</li>
<li>Right front wheel: 0.92.</li>
</ul>
</li>
</ul>
</li>
<li>Zero sterring:<ul>
<li>Expected: All zero.</li>
</ul>
</li>
<li>Negative maximum steering (-1).<ul>
<li>Expected:<ul>
<li>Left front wheel: 0.92.</li>
<li>Right front wheel: 1.08.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Graph: <img src="../../plotCalcSteer.png" alt="Steering angle of wheels related to the steering wheel angle" class="inline"/> </li>
</ul>
</li>
</ol>
<ol type="1">
<li><a href="../../../../src/VehicleModel/VehicleModelBicycle.cpp#L226">calculateSteeringWheelAngle</a>: <em>See line 226</em> Same approach to the above function values are expected to be the exact oposite of the previous function.</li>
<li><a href="../../../../src/VehicleModel/VehicleModelBicycle.cpp#L286">calculateWheelGeometry</a>: <em>See line 286</em><ul>
<li>Dependencies: None.</li>
<li>Cases tested:<ul>
<li>Zero steering: All wheel positions and velocities calculated for straight wheels.<ul>
<li>Expected: Symmetric geometry.</li>
</ul>
</li>
<li>With steering: Front wheels turned, check correct geometry.<ul>
<li>Expected: Front wheel positions/velocities reflect steering angle.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="../../../../src/VehicleModel/VehicleModelBicycle.cpp#L370">updateWheelSpeeds</a>: <em>See line 370</em><ul>
<li>Dependencies: None.</li>
<li>Cases tested:<ul>
<li>Zero velocity: All wheel speeds should be zero.</li>
<li>Forward velocity: All wheel speeds should match vehicle velocity.</li>
</ul>
</li>
</ul>
</li>
<li><a href="../../../../src/VehicleModel/VehicleModelBicycle.cpp#L473">getWheelPositions</a>: <em>See line 473</em><ul>
<li>Dependencies: None.</li>
<li>Cases tested:<ul>
<li>Vehicle at origin:<ul>
<li>Expected: <a class="el" href="../../de/d84/struct_wheels.html">Wheels</a> aligned with the original placements.</li>
</ul>
</li>
<li>Vehicle at origin but rotated:<ul>
<li>Expected: wheels aligned with the original placements but rotated.</li>
</ul>
</li>
<li>Vehicle off the origin not rotated:<ul>
<li>Expected: Same as the first test with the added offset of the new position.</li>
</ul>
</li>
<li>Vehicle off the origin rotated:<ul>
<li>Expected: Same as the second test with the added offset of the new positiion.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="../../../../src/VehicleModel/VehicleModelBicycle.cpp#L334">calculateAccelerations</a>: <em>See line 334</em><ul>
<li>Dependencies: None.</li>
<li>Cases tested:<ul>
<li>Zero input: All forces and friction are zero.<ul>
<li>Expected: (0, 0, 0)</li>
</ul>
</li>
<li>Friction only: Friction.x() is set to 10, all other inputs zero.<ul>
<li>Expected: x ≈ 0.0498, y = 0, z = 0</li>
</ul>
</li>
<li>Straight acceleration: Fx_RL = Fx_RR = 5, all else zero.<ul>
<li>Expected: x ≈ 0.0498, y = 0, z = 0</li>
</ul>
</li>
<li>Straight braking: Fx_RL = Fx_RR = -5, friction.x() = 2, all else zero.<ul>
<li>Expected: x ≈ -8/200.707, y = 0, z = 0</li>
</ul>
</li>
<li>Turning: Fx_RL = Fx_RR = 5, Fy_Front = 0.1, all else zero.<ul>
<li>Expected: x ≈ 0.0498, y ≈ -0.005, z ≈ 0</li>
</ul>
</li>
</ul>
</li>
<li>Note: Friction is added directly to acceleration, which may not be physically realistic from standstill.</li>
</ul>
</li>
</ol>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
