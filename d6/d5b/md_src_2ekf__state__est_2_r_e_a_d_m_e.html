<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Formula Student Autonomous Systems: EKF State Estimation Package</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Formula Student Autonomous Systems
   </div>
   <div id="projectbrief">The code for the main driverless system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d6/d5b/md_src_2ekf__state__est_2_r_e_a_d_m_e.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">EKF State Estimation Package</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md9"></a> The State Estimation module is responsible for the processing of the perception module and localisation sensors' data and its transformation into useful information. In this case, the data is combined to generate the best estimates possible on the pose and speed of the vehicle and the location of the cones that delimit the track.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Package Info</h1>
<ul>
<li><b>Node name:</b> ekf_state_est</li>
<li><b>Package name:</b> ekf_state_est</li>
</ul>
<h2><a class="anchor" id="autotoc_md11"></a>
Launch files</h2>
<ul>
<li><b>eufssim-slam.launch.py</b> - EUFS SIM simulator adapter and SLAM with EKF</li>
<li><b>pacsim-slam.launch.py</b> - PacSim simulator adapter and SLAM with EKF</li>
<li><b>normal-slam.launch.py</b> - in vehicle SLAM with EKF</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
Design</h1>
<p>Below, some diagrams are presented that can illustrate the structure and behaviour of the program.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Behaviour</h2>
<p>The control flow below illustrates briefly the flow of execution and information through the node, you can also checkout <a href="../../../../docs/assets/Loc_map/EKFSlam1.0.pdf">documentation pdf</a> to get a better understanding.</p>
<p><img src="../../../../docs/diagrams/state_estimation/control-flow.drawio.svg" alt="Control Flow Diagram" style="pointer-events: none;" class="inline"/></p>
<p>The sequence diagrams below illustrate in greater detail the interactions between the components of the system in a normal use case.</p>
<p><img src="../../../../docs/diagrams/state_estimation/sequence.drawio.svg" alt="Sequence Diagram" style="pointer-events: none;" class="inline"/></p>
<ol type="1">
<li>Information from localisation sensors is received in the adapter (the adapter is a layer for adaptation of the different environments the node runs in).</li>
<li>LMNode (the localisation and mapping node) processes the information and requests execution of the prediction step to the Extended Kalman Filter cass (illustrated below).<ol type="a">
<li>The Motion Model is used to utilize the Motion data to predict the change in state.</li>
<li>The Motion Model is used to reaturn the G matrix (maps the transformation from the motion to the state)</li>
<li>Get the noise matrix, required for the calculation of the predicted covariance matrix P.</li>
<li>Compute predicted X and P.</li>
</ol>
</li>
<li>After the step, the pose and map are updated and published.</li>
<li>When cone coordinates are published by perception, the LMNode receives them directly, executing the perception_callback.</li>
<li>The node requests execution of the correction step to the EKF (more detail below). For every landmark (cone):<ol type="a">
<li>Discovery is executed, checking if the observation corresponds to a new cone/landmark or one that already exists in the state vector (X)</li>
<li>H (matrix that maps the transformation from the state to the observations), Q (2x2 matrix that encodes the perception's noise) are requested to the Observation Model (class that encodes how perception data is interpreted).</li>
<li>the kalman gain (K) is calculated (smart weight that controls in what extent observations contribute to the update of the state).</li>
<li>the observation model is executed to obtain the z_hat, required for the calculation of the state.</li>
<li>Compute X and P.</li>
</ol>
</li>
<li>The EKF updates the estimates and the node publishes them.</li>
</ol>
<h2><a class="anchor" id="autotoc_md14"></a>
Structure</h2>
<p>The node is composed by multiple classes. The diagram below illustrates roughly how they sit in the code structure. The main two are the LMNode, which is the class of the node, and the Extended Kalman Filter, which corresponds to the code of the implementation of the EKF SLAM.</p>
<p><img src="../../../../docs/diagrams/state_estimation/class.drawio.svg" alt="Class Diagram" style="pointer-events: none;" class="inline"/></p>
<p>Take a look at the <a href="https://fs-feup.github.io/autonomous-systems/dir_388d5df3221aab46ce4275c3697a683f.html">Doxygen generated documentation</a>.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Full Documentation</h1>
<p>More precise documentation can be found <a href="https://github.com/fs-feup/documentation/blob/main/AS/FSFEUP_02_State_Estimation/main.pdf">here</a>.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Main External Libraries</h1>
<ul>
<li><a href="https://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen</a></li>
<li><a href="https://docs.ros.org/en/foxy/index.html">ROS2</a></li>
<li><a href="http://google.github.io/googletest/">Gtest</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
